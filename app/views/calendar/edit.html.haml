-content_for :head do
  %script
    function get_hours_of_day()
    {
    var x = 0;
    for(i=0;i<document.forms[0].elements.length;i++])
    {
    if(document.forms[0].elements[i].type=="select-one")
    {
    ="if(document.forms[0].elements[i].value == '#{session[:user]}')"
    {
    x++;
    }
    }
    }
    return x;
    }

    ="var all_but_todays_hours = #{get_user(session[:user]).weeks_hours(@sd.week)} - get_hours_of_day();"

    ID=window.setTimeout("update();", 1000);
    function update()
    {
    var s_timeleft= document.forms[0].timeleft.value;

    if(s_timeleft<=0)
    {
    for(i=0;i<document.forms[0].elements.length;i++])
    {
    if(document.forms[0].elements[i].disabled = true;
    }
    document.forms[0].timeleft.value = "0";
    document.forms[0].SUBMIT.value = "Lock Expired";
    =#window.alert("You have run out of time!  Please try again.");
    =#history.back();
    }
    else
    {
    s_timeleft = document.forms[0].timeleft.value -1;
    document.forms[0].timeleft.value = s_timeleft;
    }
    ID=window.setTimeout("update();", 1000);
    }

    function max20()
    {
    var hours = all_but_todays_hours + get_hours_of_day();

    if (hours > 20)
    {
    alert('Too Many Hours!');
    document.forms[0].SUBMIT.value = "Too Many Hours";
    document.forms[0].SUBMIT.disabled = true;
    }
    else
    {
    document.forms[0].SUBMIT.value = "Save"
    document.forms[0].SUBMIT.disabled = false
    }
    }


-content_for :main_header1 do
  Editing the Day
-content_for :main_content1 do
  -form_for :day, @sd,          |
  :url => {                     |
  :controller => :calendar,     |
  :action => :update,           |
  :year => params[:year],       |
  :month => params[:month],     |
  :day => params[:day]} do |f|  |

    %input{:type => "textbox", :value => "119", :name => "timeleft", :size => "3", :readonly => ""}

    %table#edit_day{:border => 1, :style => "table-layout:fixed;"}
      %caption
        Schedule starting on #{@start_day.date.strftime(fmt='%A, %B %d, %Y')}
      %tbody{:align => "center"}
        %tr
          %td
            %table{:border => 1}
              %tr
                %td
                  %table{:border => 1}
                    %caption Date
                    %tr<
                      %td{:class => "filler"}< &nbsp;
                    -for x in TIME_SLOTS do
                      -if admin?
                        %tr{:class => "admin_edit"}<
                          %td{:class => "admin_edit_td"}<
                            =x
                      -else
                        %tr<
                          %td{:class => "fillslot"}<
                            =x
                -for x in 1..@length.to_i
                  =render :partial => 'day',                         |
                  :locals => {:day => @start_day.date+(x-1),         |
                  :is_today => (@sd.date == @start_day.date+(x-1))}  |
      %tr
        %td
          =submit_tag value="Save", :class => "form_submit", :name => "SUBMIT"
