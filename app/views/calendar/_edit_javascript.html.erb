<script>
  function get_hours_of_day()
  {
    var x = 0;
    for(i=0;i<document.forms[0].elements.length;i++)
    {
      if(document.forms[0].elements[i].type=="select-one")
      {
      if(document.forms[0].elements[i].value == '#{session[:user]}')
      {
        x++;
      }
    }
    }
    return x;
  }

    var all_but_todays_hours = #{get_user(session[:user]).weeks_hours(@sd.week)} - get_hours_of_day();

    ID=window.setTimeout("update();", 1000);
    function update()
    {
    var s_timeleft= document.forms[0].timeleft.value;

    if(s_timeleft<=0)
    {
    for(i=0;i<document.forms[0].elements.length;i++)
    {
    if(document.forms[0].elements[i].disabled = true);
    }
    document.forms[0].timeleft.value = "0";
    document.forms[0].SUBMIT.value = "Lock Expired";

    }
    else
    {
    s_timeleft = document.forms[0].timeleft.value -1;
    document.forms[0].timeleft.value = s_timeleft;
    }
    ID=window.setTimeout("update();", 1000);
    }

    function max20()
    {
    var hours = all_but_todays_hours + get_hours_of_day();

    if (hours > 20)
    {
    alert('Too Many Hours!');
    document.forms[0].SUBMIT.value = "Too Many Hours";
    document.forms[0].SUBMIT.disabled = true;
    }
    else
    {
    document.forms[0].SUBMIT.value = "Save"
    document.forms[0].SUBMIT.disabled = false
    }
    }
    </script>